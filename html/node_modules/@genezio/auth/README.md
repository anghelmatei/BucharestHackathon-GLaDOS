<div align="center">
  <a href="https://genezio.com/">
    <picture>
      <source media="(prefers-color-scheme: dark)" srcset="https://github.com/genez-io/graphics/raw/HEAD/svg/Logo_Genezio_White.svg">
      <source media="(prefers-color-scheme: light)" srcset="https://github.com/genez-io/graphics/raw/HEAD/svg/Logo_Genezio_Black.svg">
      <img alt="genezio logo" src="https://github.com/genez-io/graphics/raw/HEAD/svg/Logo_Genezio_Black.svg">
    </picture>
  </a>
</div>

<div align="center">
  <h1>auth</h1>
  <h3></h3>
</div>
<div align="center">

[![npm-version](https://img.shields.io/npm/v/@genezio/auth.svg?style=flat&label=npm-package-version&color=62C353)](https://www.npmjs.com/package/@genezio/auth)

</div>

<div align="center">
</div>

# What is `@genezio/auth`

`@genezio/auth` is a package that provided by `genezio` to ensure comprehensive solutions for integrating various authentication providers into a `genezio` application.

# Table of Contents
- [Features](#features)
- [Getting Started](#getting-started)
- [Documentation](#documentation)
- [Examples](#examples)
- [Getting Support](#getting-support)
- [System Requirements](#system-requirements)
- [Troubleshooting](#troubleshooting)
- [Contributions](#contributions)
- [Ecosystem](#ecosystem)
- [Badge](#badge)
- [License](#license)

# Features

- 📦&nbsp; Provides comprehensive solutions for integrating various authentication providers into a `genezio` application.
- 📱&nbsp; Google, Email & Password login.
- 🧰&nbsp; Session management.
- 📝&nbsp; Token storage customization.
- 📬&nbsp; Email verification.
- 📧&nbsp; Password reset.
- 📡&nbsp; Detailed error codes.

# Getting Started

## Install `@genezio/auth`

To install the `@genezio/auth` package, you can use npm or yarn:

```bash
npm install @genezio/auth
```

```bash
yarn add @genezio/auth
```
# Examples

### Configuration
At the beginning you need to configure the authentication token and region of your `genezio` application. These can be found Authentication Configuration screen on the `genezio` Dashboard.
```typescript title="client/src/main.tsx" showLineNumbers
import { AuthService } from "@genezio/auth";

AuthService.getInstance().setTokenAndRegion("<token>", "<region>");
```
### Register with Email & Password

This will trigger the AuthService's register method whenever someone clicks the "Sign Up" button:
```typescript title="client/src/routes/signup.tsx" showLineNumbers
const handleSubmit = async (event: React.FormEvent) => {
  event.preventDefault();
  setLoading(true);
  try {
      const response = await AuthService.getInstance().register(email, password, name);
      console.log('Register Success', response);

      navigate('/login');
  } catch (error: any) {
      console.log(error);
      alert("An error has occured")
  }
  setLoading(false);
};
```

### Login with Email & Password
This will trigger the AuthService's login method whenever someone clicks the "Login" button:
```typescript title="client/src/routes/login.tsx" showLineNumbers
const handleSubmit = async (event: React.FormEvent) => {
    event.preventDefault();
    setLoginLoading(true);

    try {
        await AuthService.getInstance().login(email, password)
        navigate("/");
    } catch (error: any) {
        console.log('Login Failed', error);
        alert('Login Failed');
    }
    setLoginLoading(false);
}
```

### Google Login
This will trigger the AuthService's googleRegistration method whenever someone clicks the Google login button:
```typescript title="client/src/routes/login.tsx" showLineNumbers
const handleGoogleLogin = async (credentialResponse: CredentialResponse) => {
    console.log(credentialResponse);
    setGoogleLoginLoading(true);

    try {
        await AuthService.getInstance().googleRegistration(credentialResponse.credential!)

        console.log('Login Success');
        navigate('/');
    } catch(error: any) {
        console.log('Login Failed', error);
        alert('Login Failed');
    }
    setGoogleLoginLoading(false);
};
```

### Verify if user is logged in
The `userInfo` method on the `AuthService` is for getting the user's information. You can use this method to check if the user is logged in or not.
```typescript title="client/src/routes/secret.tsx" showLineNumbers
useEffect(() => {
    if (name && email) {
        return;
    }

    AuthService.getInstance().userInfo().then((user) => {
        setName(user.name!);
        setEmail(user.email);
    }).catch((error) => {
        console.error(error);
    })
}, []);
```

### Logout
The `logout` method on the `AuthService` is for logging the user out.
```typescript title="client/src/routes/secret.tsx" showLineNumbers
const logout = async () => {
  try {
      await AuthService.getInstance().logout();
      navigate('/login');
  } catch (error) {
      console.error(error);
  }
}
```
### Handling Errors
The `ErrorCode` enum contains all the error codes that can be thrown by the `@genezio/auth` package.
```typescript title="client/src/routes/signup.tsx" showLineNumbers
import { AuthService, ErrorCode } from '@genezio/auth';
```

```typescript title="client/src/routes/signup.tsx" showLineNumbers
const handleSubmit = async (event: React.FormEvent) => {
    event.preventDefault();
    setLoading(true);
    try {
        const response = await AuthService.getInstance().register(email, password, name);
        console.log('Register Success', response);

        navigate('/login');
    } catch (error: any) {
        console.log(error);
        if (error.code === ErrorCode.EMAIL_ALREADY_EXISTS) {
            alert("Email already exists")
        } else { 
            alert("An error has occured")
        }
    }
    setLoading(false);
};
```

### Backend Integration
Here `getSecret` method is protected by `@GnzAuth` decorator. This will ensure that only authenticated users can access this method.
```typescript title="server/backend.ts" showLineNumbers
import { GenezioDeploy, GenezioMethod, GnzAuth, GnzContext } from "@genezio/types";

@GenezioDeploy()
export class BackendClass {
  secret: string = "Hello World!";

  @GenezioMethod()
  @GnzAuth()
  async getSecret(context: GnzContext) {
    console.log(context.user);
    return this.secret;
  }
}
```

# Documentation
To find more details on how to use `@genezio/auth`, check out the official [documentation](https://genezio.com/docs/auth)

Here you can find some examples:
- [Auth example](https://github.com/Genez-io/genezio-react-auth)

To find more details on how to use `genezio`, check out the official [documentation](https://genezio.com/docs):

- [Getting started](https://genezio.com/docs/getting-started)
- [Project Structure](https://genezio.com/docs/project-structure/)
- [CLI commands](https://genezio.com/docs/cli-tool/)
- [Test Interface](https://genezio.com/docs/features/testing)
- [Integrations](https://genezio.com/docs/integrations/)

If you cannot find what you are looking for in the docs, don't hesitate to drop us a [GitHub issue](https://github.com/Genez-io/genezio/issues) or [start a discussion on Discord](https://discord.gg/uc9H5YKjXv).

# Getting support

We are here to assist you with any problems or questions you may have while using `@genezio/auth`. Don't hesitate to reach out to us on [GitHub](https://github.com/Genez-io/genezio/issues) or join our [Discord community](https://discord.gg/uc9H5YKjXv) for real-time assistance.

# System requirements

`@genezio/auth` can be used in Genezio projects developed on macOS, Linux-based distributions, and Windows.

It is designed to work with Node.js versions >= `16.0.0`.

# Troubleshooting

For the most common issues that our users have dealt with, we created a [Troubleshooting](https://genezio.com/docs/troubleshooting) section in the documentation.

If you don't find the guidance there, drop us a [GitHub issue](https://github.com/Genez-io/AuthService/issues). We are more than happy to help you!

# Contributing

Contributions are welcome! Please see our [Contributing Guide](CONTRIBUTING.md) for more details.

Show your support by giving us a star :star:, to help others discover `genezio` and become part of our community!

# Ecosystem

There are a growing number of awesome projects deployed with `genezio` and we want to shout out about them.

If you deployed a project using `genezio` let us know on [Discord](https://discord.gg/uc9H5YKjXv) and we will add it to our [Hall Of Fame](https://github.com/Genez-io/genezio#hall-of-fame).

# Badge

Brag to your friends that you are using `genezio` with this awesome badge -> [![deployed with: genezio](https://img.shields.io/badge/deployed_with-genezio-6742c1.svg?labelColor=62C353&style=flat)](https://github.com/genez-io/genezio)

```md
[![deployed with: genezio](https://img.shields.io/badge/deployed_with-genezio-6742c1.svg?labelColor=62C353&style=flat)](https://github.com/genez-io/genezio)
```

# License

`@genezio/auth` is licensed under `GNU General Public License v3.0`. For more information, please refer to [LICENSE](LICENSE)